<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NFT Marketplace Security Audit - Comprehensive Report</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            border-radius: 15px;
            overflow: hidden;
        }

        .security-header {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: white;
            padding: 50px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .security-header::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 1px, transparent 1px);
            background-size: 50px 50px;
            animation: float 20s linear infinite;
            z-index: 0;
        }

        @keyframes float {
            0% { transform: translate(0, 0) rotate(0deg); }
            100% { transform: translate(0, 0) rotate(360deg); }
        }

        .header-content {
            position: relative;
            z-index: 1;
        }

        .security-header h1 {
            font-size: 2.8rem;
            margin-bottom: 15px;
            background: linear-gradient(90deg, #00b4db, #0083b0);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }

        .security-header .subtitle {
            font-size: 1.3rem;
            opacity: 0.9;
            margin-bottom: 20px;
        }

        .audit-badge {
            display: inline-block;
            background: linear-gradient(135deg, #00b4db, #0083b0);
            color: white;
            padding: 8px 20px;
            border-radius: 25px;
            font-weight: 600;
            font-size: 0.9rem;
            margin: 10px;
            border: 2px solid rgba(255,255,255,0.2);
        }

        .content {
            padding: 50px;
        }

        .section {
            margin-bottom: 60px;
            page-break-inside: avoid;
            border-left: 4px solid #00b4db;
            padding-left: 25px;
            background: linear-gradient(to right, rgba(0, 180, 219, 0.05), transparent);
            border-radius: 0 10px 10px 0;
        }

        .section-title {
            color: #16213e;
            margin-bottom: 25px;
            font-size: 2rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .section-title i {
            color: #00b4db;
            font-size: 1.8rem;
        }

        .subsection {
            margin-bottom: 35px;
            padding: 25px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
            border: 1px solid #e9ecef;
            transition: transform 0.3s ease;
        }

        .subsection:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }

        .subsection-title {
            color: #16213e;
            font-size: 1.5rem;
            margin-bottom: 15px;
            font-weight: 600;
            border-bottom: 2px solid #00b4db;
            padding-bottom: 10px;
        }

        p {
            margin-bottom: 20px;
            color: #555;
            font-size: 1.05rem;
        }

        ul, ol {
            margin-left: 30px;
            margin-bottom: 20px;
        }

        li {
            margin-bottom: 12px;
            position: relative;
            padding-left: 10px;
        }

        li:before {
            content: 'â–¸';
            color: #00b4db;
            position: absolute;
            left: -20px;
        }

        .vulnerability-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 25px;
            margin: 30px 0;
        }

        .vulnerability-card {
            background: white;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
            transition: all 0.3s ease;
            border-top: 5px solid #00b4db;
        }

        .vulnerability-card.critical {
            border-top-color: #ff4757;
            background: linear-gradient(135deg, #ff475710 0%, #ff475705 100%);
        }

        .vulnerability-card.high {
            border-top-color: #ffa502;
            background: linear-gradient(135deg, #ffa50210 0%, #ffa50205 100%);
        }

        .vulnerability-card.medium {
            border-top-color: #ffd166;
            background: linear-gradient(135deg, #ffd16610 0%, #ffd16605 100%);
        }

        .vulnerability-card.low {
            border-top-color: #00d4aa;
            background: linear-gradient(135deg, #00d4aa10 0%, #00d4aa05 100%);
        }

        .vulnerability-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .vulnerability-title {
            font-size: 1.3rem;
            font-weight: 600;
            color: #16213e;
        }

        .severity-badge {
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 700;
            color: white;
        }

        .severity-badge.critical { background: #ff4757; }
        .severity-badge.high { background: #ffa502; }
        .severity-badge.medium { background: #ffd166; color: #333; }
        .severity-badge.low { background: #00d4aa; }

        .code-block {
            background: #1a1a2e;
            color: #e2e8f0;
            padding: 25px;
            border-radius: 10px;
            font-family: 'Courier New', monospace;
            margin: 20px 0;
            overflow-x: auto;
            border-left: 5px solid #00b4db;
        }

        .code-block pre {
            white-space: pre-wrap;
            word-wrap: break-word;
        }

        .table-container {
            overflow-x: auto;
            margin: 25px 0;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin: 0;
        }

        th {
            background: linear-gradient(135deg, #00b4db, #0083b0);
            color: white;
            padding: 18px;
            text-align: left;
            font-weight: 600;
            font-size: 1.1rem;
        }

        td {
            padding: 18px;
            border-bottom: 1px solid #e9ecef;
            color: #555;
        }

        tr:nth-child(even) {
            background: #f8f9fa;
        }

        .chart-container {
            background: white;
            padding: 30px;
            border-radius: 12px;
            margin: 40px 0;
            box-shadow: 0 10px 30px rgba(0,0,0,0.08);
            border: 1px solid #e9ecef;
        }

        .chart-title {
            text-align: center;
            font-size: 1.5rem;
            margin-bottom: 30px;
            color: #16213e;
            font-weight: 600;
        }

        canvas {
            max-height: 400px;
        }

        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 25px;
            margin: 40px 0;
        }

        .metric-card {
            background: white;
            padding: 30px;
            border-radius: 12px;
            text-align: center;
            box-shadow: 0 8px 25px rgba(0,0,0,0.08);
            transition: transform 0.3s ease;
            border-top: 5px solid;
            position: relative;
            overflow: hidden;
        }

        .metric-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 5px;
            background: linear-gradient(90deg, #00b4db, #0083b0);
        }

        .metric-card:hover {
            transform: translateY(-10px);
            box-shadow: 0 15px 35px rgba(0,0,0,0.12);
        }

        .metric-value {
            font-size: 3rem;
            font-weight: 800;
            margin-bottom: 10px;
            background: linear-gradient(90deg, #00b4db, #0083b0);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }

        .metric-label {
            color: #666;
            font-size: 1.1rem;
            font-weight: 500;
        }

        .recommendation-box {
            background: linear-gradient(135deg, #00b4db10 0%, #0083b005 100%);
            border-left: 5px solid #00b4db;
            padding: 25px;
            margin: 25px 0;
            border-radius: 0 10px 10px 0;
        }

        .recommendation-title {
            color: #0083b0;
            font-weight: 600;
            margin-bottom: 15px;
            font-size: 1.2rem;
        }

        .action-buttons {
            display: flex;
            gap: 20px;
            margin-top: 50px;
            justify-content: center;
            padding: 30px;
            background: #f8f9fa;
            border-top: 1px solid #e9ecef;
        }

        .btn {
            padding: 15px 40px;
            border-radius: 8px;
            text-decoration: none;
            font-weight: 700;
            cursor: pointer;
            border: none;
            transition: all 0.3s ease;
            font-size: 1.1rem;
            display: inline-flex;
            align-items: center;
            gap: 10px;
        }

        .btn-download {
            background: linear-gradient(135deg, #00b4db, #0083b0);
            color: white;
            box-shadow: 0 5px 20px rgba(0, 180, 219, 0.3);
        }

        .btn-download:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 30px rgba(0, 180, 219, 0.4);
        }

        .btn-print {
            background: #16213e;
            color: white;
            box-shadow: 0 5px 20px rgba(22, 33, 62, 0.2);
        }

        .btn-print:hover {
            background: #1a1a2e;
            transform: translateY(-3px);
        }

        .btn-back {
            background: white;
            color: #16213e;
            border: 2px solid #e9ecef;
        }

        .btn-back:hover {
            background: #f8f9fa;
            border-color: #00b4db;
        }

        .watermark {
            position: fixed;
            bottom: 20px;
            right: 20px;
            opacity: 0.1;
            font-size: 8rem;
            color: #00b4db;
            pointer-events: none;
            z-index: -1;
        }

        .auditor-signature {
            text-align: center;
            padding: 40px;
            border-top: 2px solid #e9ecef;
            margin-top: 50px;
        }

        .signature {
            font-family: 'Brush Script MT', cursive;
            font-size: 2.5rem;
            color: #16213e;
            margin: 20px 0;
        }

        @media print {
            body {
                background: white;
                padding: 0;
            }
            
            .container {
                box-shadow: none;
                border-radius: 0;
            }
            
            .action-buttons {
                display: none;
            }
            
            .watermark {
                display: none;
            }
        }

        @media (max-width: 768px) {
            .content {
                padding: 25px;
            }
            
            .security-header {
                padding: 30px 20px;
            }
            
            .security-header h1 {
                font-size: 2rem;
            }
            
            .vulnerability-grid {
                grid-template-columns: 1fr;
            }
            
            .metrics-grid {
                grid-template-columns: 1fr;
            }
            
            .action-buttons {
                flex-direction: column;
            }
            
            .btn {
                width: 100%;
                justify-content: center;
            }
        }
    </style>
</head>
<body>
    <div class="watermark">SECURITY</div>
    <div class="container" id="pdf-content">
        <!-- Security Header -->
        <div class="security-header">
            <div class="header-content">
                <h1>NFT Marketplace Security Audit Report</h1>
                <div class="subtitle">Comprehensive Smart Contract Security Assessment & Vulnerability Analysis</div>
                <div style="margin-top: 30px;">
                    <span class="audit-badge">Smart Contract Security</span>
                    <span class="audit-badge">Vulnerability Assessment</span>
                    <span class="audit-badge">Remediation Guidance</span>
                </div>
                <div style="margin-top: 40px; font-size: 1rem; opacity: 0.9;">
                    <p><strong>Auditor:</strong> Emmanuel Olatoye | Blockchain Security Specialist</p>
                    <p><strong>Audit Date:</strong> October 15 - November 10, 2023</p>
                    <p><strong>Report Version:</strong> 3.0 | Confidential</p>
                </div>
            </div>
        </div>

        <!-- Content Section -->
        <div class="content">
            <!-- Executive Summary -->
            <div class="section">
                <h2 class="section-title"><i class="fas fa-file-alt"></i> Executive Summary</h2>
                <div class="subsection">
                    <h3 class="subsection-title">Overview</h3>
                    <p>This comprehensive security audit was conducted on an NFT marketplace smart contract system to identify vulnerabilities, assess security posture, and provide actionable remediation strategies. The audit covered 8 smart contracts comprising 3,450 lines of Solidity code with a focus on ERC-721, ERC-1155, and marketplace functionality.</p>
                    
                    <div class="metrics-grid">
                        <div class="metric-card">
                            <div class="metric-value">82%</div>
                            <div class="metric-label">Code Coverage</div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-value">15</div>
                            <div class="metric-label">Issues Identified</div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-value">0</div>
                            <div class="metric-label">Critical Issues</div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-value">3</div>
                            <div class="metric-label">High Severity Issues</div>
                        </div>
                    </div>
                </div>

                <div class="recommendation-box">
                    <div class="recommendation-title">Key Recommendation</div>
                    <p><strong>Immediate Action Required:</strong> Address 3 high-severity vulnerabilities related to reentrancy and access control before production deployment. Implement the recommended fixes to prevent potential loss of funds and NFT theft.</p>
                </div>
            </div>

            <!-- Audit Scope -->
            <div class="section">
                <h2 class="section-title"><i class="fas fa-search"></i> Audit Scope & Methodology</h2>
                
                <div class="subsection">
                    <h3 class="subsection-title">Scope of Audit</h3>
                    <ul>
                        <li><strong>Smart Contracts:</strong> 8 contracts (Marketplace, NFTFactory, Auction, Royalty, etc.)</li>
                        <li><strong>Lines of Code:</strong> 3,450 lines of Solidity</li>
                        <li><strong>Standards:</strong> ERC-721, ERC-1155 compliance</li>
                        <li><strong>Testing:</strong> Unit tests, integration tests, fuzzing tests</li>
                        <li><strong>Tools Used:</strong> Slither, Mythril, Foundry, Hardhat</li>
                    </ul>
                </div>

                <div class="subsection">
                    <h3 class="subsection-title">Audit Methodology</h3>
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>Phase</th>
                                    <th>Activities</th>
                                    <th>Duration</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>1. Manual Code Review</td>
                                    <td>Line-by-line analysis of all smart contracts</td>
                                    <td>7 days</td>
                                </tr>
                                <tr>
                                    <td>2. Automated Analysis</td>
                                    <td>Slither, Mythril, and custom tool analysis</td>
                                    <td>3 days</td>
                                </tr>
                                <tr>
                                    <td>3. Threat Modeling</td>
                                    <td>Attack vector identification and risk assessment</td>
                                    <td>2 days</td>
                                </tr>
                                <tr>
                                    <td>4. Testing</td>
                                    <td>Unit tests, integration tests, fuzzing</td>
                                    <td>5 days</td>
                                </tr>
                                <tr>
                                    <td>5. Remediation Review</td>
                                    <td>Verification of implemented fixes</td>
                                    <td>3 days</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Vulnerability Findings -->
            <div class="section">
                <h2 class="section-title"><i class="fas fa-exclamation-triangle"></i> Vulnerability Findings</h2>
                
                <div class="chart-container">
                    <div class="chart-title">Vulnerability Severity Distribution</div>
                    <canvas id="severityChart"></canvas>
                </div>

                <div class="vulnerability-grid">
                    <!-- Critical Vulnerabilities -->
                    <div class="vulnerability-card high">
                        <div class="vulnerability-header">
                            <div class="vulnerability-title">Reentrancy in Marketplace</div>
                            <div class="severity-badge high">HIGH</div>
                        </div>
                        <p><strong>Location:</strong> Marketplace.sol, Line 142-156</p>
                        <p><strong>Impact:</strong> Potential loss of funds during NFT purchases</p>
                        <p><strong>Description:</strong> External call before state update could allow reentrant calls to drain contract funds.</p>
                        <div class="code-block">
                            <pre>// Vulnerable Code
function purchaseNFT(uint256 tokenId) external payable {
    require(msg.value >= price, "Insufficient funds");
    // External call before state update
    (bool success, ) = seller.call{value: msg.value}("");
    require(success, "Transfer failed");
    // State update after external call
    _transferNFT(seller, msg.sender, tokenId);
}</pre>
                        </div>
                    </div>

                    <div class="vulnerability-card high">
                        <div class="vulnerability-header">
                            <div class="vulnerability-title">Missing Access Control</div>
                            <div class="severity-badge high">HIGH</div>
                        </div>
                        <p><strong>Location:</strong> Auction.sol, Line 89-105</p>
                        <p><strong>Impact:</strong> Unauthorized withdrawal of auction funds</p>
                        <p><strong>Description:</strong> Missing access control allows any user to withdraw auction proceeds.</p>
                        <div class="code-block">
                            <pre>// Vulnerable Code
function withdrawProceeds(uint256 auctionId) external {
    Auction storage auction = auctions[auctionId];
    uint256 amount = auction.highestBid;
    // Missing access control check
    (bool success, ) = auction.highestBidder.call{value: amount}("");
    require(success, "Transfer failed");
}</pre>
                        </div>
                    </div>

                    <div class="vulnerability-card medium">
                        <div class="vulnerability-header">
                            <div class="vulnerability-title">Integer Overflow</div>
                            <div class="severity-badge medium">MEDIUM</div>
                        </div>
                        <p><strong>Location:</strong> Royalty.sol, Line 67-72</p>
                        <p><strong>Impact:</strong> Incorrect royalty calculations</p>
                        <p><strong>Description:</strong> Potential integer overflow in royalty fee calculation.</p>
                    </div>

                    <div class="vulnerability-card medium">
                        <div class="vulnerability-header">
                            <div class="vulnerability-title">Front-running Vulnerability</div>
                            <div class="severity-badge medium">MEDIUM</div>
                        </div>
                        <p><strong>Location:</strong> Marketplace.sol, Line 203-215</p>
                        <p><strong>Impact:</strong> Transaction front-running</p>
                        <p><strong>Description:</strong> No protection against front-running in NFT listing updates.</p>
                    </div>

                    <div class="vulnerability-card low">
                        <div class="vulnerability-header">
                            <div class="vulnerability-title">Gas Inefficiency</div>
                            <div class="severity-badge low">LOW</div>
                        </div>
                        <p><strong>Location:</strong> NFTFactory.sol, Line 45-60</p>
                        <p><strong>Impact:</strong> Higher gas costs</p>
                        <p><strong>Description:</strong> Inefficient storage patterns increase gas costs.</p>
                    </div>

                    <div class="vulnerability-card low">
                        <div class="vulnerability-header">
                            <div class="vulnerability-title">Event Log Missing Parameters</div>
                            <div class="severity-badge low">LOW</div>
                        </div>
                        <p><strong>Location:</strong> Multiple contracts</p>
                        <p><strong>Impact:</strong> Poor off-chain monitoring</p>
                        <p><strong>Description:</strong> Important event parameters missing from event logs.</p>
                    </div>
                </div>
            </div>

            <!-- Remediation Strategies -->
            <div class="section">
                <h2 class="section-title"><i class="fas fa-wrench"></i> Remediation Strategies</h2>
                
                <div class="subsection">
                    <h3 class="subsection-title">Reentrancy Protection</h3>
                    <p><strong>Issue:</strong> Reentrancy vulnerability in purchaseNFT function</p>
                    <p><strong>Solution:</strong> Implement Checks-Effects-Interactions pattern</p>
                    <div class="code-block">
                        <pre>// Fixed Code
function purchaseNFT(uint256 tokenId) external payable nonReentrant {
    require(msg.value >= price, "Insufficient funds");
    
    // State update before external call
    _transferNFT(seller, msg.sender, tokenId);
    
    // External call after state update
    (bool success, ) = seller.call{value: msg.value}("");
    require(success, "Transfer failed");
    
    emit NFTPurchased(tokenId, msg.sender, msg.value);
}</pre>
                    </div>
                </div>

                <div class="subsection">
                    <h3 class="subsection-title">Access Control Implementation</h3>
                    <p><strong>Issue:</strong> Missing access control in auction withdrawal</p>
                    <p><strong>Solution:</strong> Add proper access control modifiers</p>
                    <div class="code-block">
                        <pre>// Fixed Code
function withdrawProceeds(uint256 auctionId) external {
    Auction storage auction = auctions[auctionId];
    
    // Access control check
    require(
        msg.sender == auction.highestBidder ||
        msg.sender == auction.owner,
        "Unauthorized"
    );
    
    require(auction.ended, "Auction not ended");
    require(!auction.proceedsWithdrawn, "Already withdrawn");
    
    auction.proceedsWithdrawn = true;
    uint256 amount = auction.highestBid;
    
    (bool success, ) = auction.highestBidder.call{value: amount}("");
    require(success, "Transfer failed");
    
    emit ProceedsWithdrawn(auctionId, amount);
}</pre>
                    </div>
                </div>
            </div>

            <!-- Security Assessment -->
            <div class="section">
                <h2 class="section-title"><i class="fas fa-shield-alt"></i> Security Assessment</h2>
                
                <div class="chart-container">
                    <div class="chart-title">Security Score Breakdown</div>
                    <canvas id="securityChart"></canvas>
                </div>

                <div class="subsection">
                    <h3 class="subsection-title">Overall Security Score: 8.5/10</h3>
                    
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>Category</th>
                                    <th>Score</th>
                                    <th>Status</th>
                                    <th>Remarks</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>Access Control</td>
                                    <td>7/10</td>
                                    <td><span style="color: orange;">Needs Improvement</span></td>
                                    <td>Missing role-based access control in some functions</td>
                                </tr>
                                <tr>
                                    <td>Reentrancy Protection</td>
                                    <td>9/10</td>
                                    <td><span style="color: green;">Good</span></td>
                                    <td>Mostly protected, one instance needs fixing</td>
                                </tr>
                                <tr>
                                    <td>Input Validation</td>
                                    <td>8/10</td>
                                    <td><span style="color: green;">Good</span></td>
                                    <td>Comprehensive validation implemented</td>
                                </tr>
                                <tr>
                                    <td>Gas Optimization</td>
                                    <td>7/10</td>
                                    <td><span style="color: orange;">Needs Improvement</span></td>
                                    <td>Several gas inefficiencies identified</td>
                                </tr>
                                <tr>
                                    <td>Code Quality</td>
                                    <td>9/10</td>
                                    <td><span style="color: green;">Excellent</span></td>
                                    <td>Clean, well-documented code</td>
                                </tr>
                                <tr>
                                    <td>Test Coverage</td>
                                    <td>8/10</td>
                                    <td><span style="color: green;">Good</span></td>
                                    <td>82% test coverage achieved</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Recommendations -->
            <div class="section">
                <h2 class="section-title"><i class="fas fa-clipboard-check"></i> Recommendations</h2>
                
                <div class="subsection">
                    <h3 class="subsection-title">Immediate Actions (Before Deployment)</h3>
                    <ol>
                        <li><strong>Fix Reentrancy Vulnerability:</strong> Implement nonReentrant modifier and follow CEI pattern</li>
                        <li><strong>Add Access Control:</strong> Implement proper role-based access control for admin functions</li>
                        <li><strong>Add Pausable Mechanism:</strong> Implement emergency stop functionality</li>
                        <li><strong>Fix Integer Overflow:</strong> Use SafeMath or Solidity 0.8.x built-in overflow protection</li>
                    </ol>
                </div>

                <div class="subsection">
                    <h3 class="subsection-title">Best Practices Implementation</h3>
                    <ul>
                        <li>Implement time-lock for critical operations</li>
                        <li>Add multi-signature wallet for treasury management</li>
                        <li>Implement comprehensive event logging</li>
                        <li>Add circuit breaker pattern for emergency stops</li>
                        <li>Implement upgradeable contract pattern</li>
                        <li>Add comprehensive monitoring and alerting</li>
                    </ul>
                </div>
            </div>

            <!-- Appendix -->
            <div class="section">
                <h2 class="section-title"><i class="fas fa-file-code"></i> Appendix</h2>
                
                <div class="subsection">
                    <h3 class="subsection-title">Tools Used in Audit</h3>
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>Tool</th>
                                    <th>Purpose</th>
                                    <th>Findings</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>Slither</td>
                                    <td>Static analysis</td>
                                    <td>8 vulnerabilities detected</td>
                                </tr>
                                <tr>
                                    <td>Mythril</td>
                                    <td>Security analysis</td>
                                    <td>5 vulnerabilities detected</td>
                                </tr>
                                <tr>
                                    <td>Foundry</td>
                                    <td>Fuzz testing</td>
                                    <td>2 edge cases discovered</td>
                                </tr>
                                <tr>
                                    <td>Hardhat</td>
                                    <td>Development environment</td>
                                    <td>Test framework execution</td>
                                </tr>
                                <tr>
                                    <td>Echidna</td>
                                    <td>Property testing</td>
                                    <td>Property violations found</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <div class="subsection">
                    <h3 class="subsection-title">Test Coverage Report</h3>
                    <div class="chart-container">
                        <div class="chart-title">Test Coverage by Contract</div>
                        <canvas id="coverageChart"></canvas>
                    </div>
                </div>
            </div>

            <!-- Auditor Signature -->
            <div class="auditor-signature">
                <h3 style="color: #16213e; margin-bottom: 20px;">Audit Verification</h3>
                <p style="color: #666; margin-bottom: 30px;">This audit was conducted according to industry best practices and security standards.</p>
                <div class="signature">Emmanuel Olatoye</div>
                <p><strong>Blockchain Security Auditor</strong></p>
                <p>Certified Smart Contract Auditor | CEH | OSCP</p>
                <p style="margin-top: 30px; color: #888; font-size: 0.9rem;">
                    Report ID: NFT-AUDIT-2023-11-001<br>
                    Hash Verification: 0x8a3b9f...c7d2e1
                </p>
            </div>
        </div>

        <!-- Action Buttons -->
        <div class="action-buttons">
            <button class="btn btn-download" onclick="generatePDF()">
                <i class="fas fa-download"></i> Download PDF Report
            </button>
            <button class="btn btn-print" onclick="window.print()">
                <i class="fas fa-print"></i> Print Report
            </button>
            <a href="index.html" class="btn btn-back">
                <i class="fas fa-arrow-left"></i> Back to Portfolio
            </a>
        </div>
    </div>

    <script>
        // Charts Data and Configuration
        function initializeCharts() {
            // Severity Distribution Chart
            const severityCtx = document.getElementById('severityChart').getContext('2d');
            new Chart(severityCtx, {
                type: 'doughnut',
                data: {
                    labels: ['Critical', 'High', 'Medium', 'Low', 'Informational'],
                    datasets: [{
                        data: [0, 3, 6, 4, 2],
                        backgroundColor: [
                            '#ff4757',
                            '#ffa502',
                            '#ffd166',
                            '#00d4aa',
                            '#747d8c'
                        ],
                        borderWidth: 2,
                        borderColor: 'white'
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                padding: 20,
                                font: {
                                    size: 12
                                }
                            }
                        }
                    }
                }
            });

            // Security Score Chart
            const securityCtx = document.getElementById('securityChart').getContext('2d');
            new Chart(securityCtx, {
                type: 'radar',
                data: {
                    labels: ['Access Control', 'Reentrancy', 'Input Validation', 'Gas Opt', 'Code Quality', 'Test Coverage'],
                    datasets: [{
                        label: 'Security Score',
                        data: [7, 9, 8, 7, 9, 8],
                        backgroundColor: 'rgba(0, 180, 219, 0.2)',
                        borderColor: '#00b4db',
                        borderWidth: 3,
                        pointBackgroundColor: '#00b4db',
                        pointBorderColor: 'white',
                        pointBorderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        r: {
                            beginAtZero: true,
                            max: 10,
                            ticks: {
                                stepSize: 2
                            },
                            grid: {
                                color: 'rgba(0,0,0,0.1)'
                            },
                            angleLines: {
                                color: 'rgba(0,0,0,0.1)'
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            display: false
                        }
                    }
                }
            });

            // Coverage Chart
            const coverageCtx = document.getElementById('coverageChart').getContext('2d');
            new Chart(coverageCtx, {
                type: 'bar',
                data: {
                    labels: ['Marketplace', 'Auction', 'NFTFactory', 'Royalty', 'Staking', 'Governance'],
                    datasets: [{
                        label: 'Test Coverage %',
                        data: [85, 78, 92, 88, 75, 70],
                        backgroundColor: [
                            'rgba(0, 180, 219, 0.8)',
                            'rgba(0, 180, 219, 0.8)',
                            'rgba(0, 180, 219, 0.8)',
                            'rgba(0, 180, 219, 0.8)',
                            'rgba(0, 180, 219, 0.8)',
                            'rgba(0, 180, 219, 0.8)'
                        ],
                        borderColor: '#00b4db',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 100,
                            ticks: {
                                callback: function(value) {
                                    return value + '%';
                                }
                            },
                            grid: {
                                color: 'rgba(0,0,0,0.05)'
                            }
                        },
                        x: {
                            grid: {
                                display: false
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            display: false
                        }
                    }
                }
            });
        }

        // Function to generate PDF
        function generatePDF() {
            const element = document.getElementById('pdf-content');
            const buttons = document.querySelector('.action-buttons');
            
            // Hide buttons before capturing
            buttons.style.display = 'none';
            
            // Add watermark for PDF
            const watermark = document.createElement('div');
            watermark.style.position = 'absolute';
            watermark.style.top = '50%';
            watermark.style.left = '50%';
            watermark.style.transform = 'translate(-50%, -50%) rotate(-45deg)';
            watermark.style.fontSize = '100px';
            watermark.style.color = 'rgba(0, 180, 219, 0.1)';
            watermark.style.zIndex = '1000';
            watermark.style.pointerEvents = 'none';
            watermark.textContent = 'CONFIDENTIAL';
            element.appendChild(watermark);
            
            html2canvas(element, {
                scale: 2,
                useCORS: true,
                logging: false,
                windowWidth: element.scrollWidth,
                windowHeight: element.scrollHeight,
                backgroundColor: '#ffffff'
            }).then(canvas => {
                const imgData = canvas.toDataURL('image/png');
                const pdf = new jspdf.jsPDF({
                    orientation: 'portrait',
                    unit: 'mm',
                    format: 'a4',
                    compress: true
                });

                const imgWidth = 190; // Reduced for margins
                const pageHeight = 287; // A4 height in mm
                const imgHeight = canvas.height * imgWidth / canvas.width;
                let heightLeft = imgHeight;
                let position = 10; // Start 10mm from top

                // Add watermark to PDF
                pdf.setFontSize(60);
                pdf.setTextColor(230, 230, 230);
                pdf.text('CONFIDENTIAL', 105, 150, null, null, 'center');
                pdf.setTextColor(0, 0, 0);

                pdf.addImage(imgData, 'PNG', 10, position, imgWidth, imgHeight);
                heightLeft -= pageHeight;

                while (heightLeft >= 0) {
                    position = heightLeft - imgHeight;
                    pdf.addPage();
                    pdf.addImage(imgData, 'PNG', 10, position, imgWidth, imgHeight);
                    heightLeft -= pageHeight;
                }

                pdf.save('NFT-Marketplace-Security-Audit-Report.pdf');
                
                // Clean up
                element.removeChild(watermark);
                buttons.style.display = 'flex';
            });
        }

        // Initialize charts when page loads
        window.addEventListener('load', function() {
            initializeCharts();
            
            // Add Font Awesome icons
            const faLink = document.createElement('link');
            faLink.rel = 'stylesheet';
            faLink.href = 'https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css';
            document.head.appendChild(faLink);
        });

        // Auto-generate PDF on Ctrl+P
        document.addEventListener('keydown', function(e) {
            if ((e.ctrlKey || e.metaKey) && e.key === 'p') {
                e.preventDefault();
                generatePDF();
            }
        });
    </script>
</body>
</html>